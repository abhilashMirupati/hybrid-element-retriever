<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPA Route Change Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .nav-bar {
            background: #2c3e50;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .nav-list {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-item {
            flex: 1;
        }
        .nav-link {
            display: block;
            padding: 20px;
            color: white;
            text-decoration: none;
            text-align: center;
            transition: background 0.3s;
            cursor: pointer;
        }
        .nav-link:hover {
            background: #34495e;
        }
        .nav-link.active {
            background: #3498db;
        }
        .content-area {
            padding: 40px;
            min-height: 500px;
        }
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }
        .page.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .product {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .product img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn:hover {
            background: #2980b9;
        }
        .user-list {
            list-style: none;
            padding: 0;
        }
        .user-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #eee;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        .route-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav class="nav-bar">
            <ul class="nav-list">
                <li class="nav-item">
                    <a class="nav-link active" data-route="/" aria-label="Navigate to Home">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-route="/products" aria-label="Navigate to Products">Products</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-route="/users" aria-label="Navigate to Users">Users</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-route="/contact" aria-label="Navigate to Contact">Contact</a>
                </li>
            </ul>
        </nav>

        <div class="content-area" id="content">
            <!-- Home Page -->
            <div id="home-page" class="page active">
                <h1>Welcome to SPA Test Application</h1>
                <p>This application demonstrates Single Page Application routing with history.pushState</p>
                
                <section>
                    <h2>Featured Content</h2>
                    <div id="featured-section">
                        <button class="btn" id="home-action" aria-label="Perform home action">Home Action Button</button>
                        <p>Current timestamp: <span id="timestamp"></span></p>
                    </div>
                </section>

                <section>
                    <h2>Quick Links</h2>
                    <ul>
                        <li><a href="#" onclick="navigateTo('/products'); return false;">Browse Products</a></li>
                        <li><a href="#" onclick="navigateTo('/users'); return false;">View Users</a></li>
                        <li><a href="#" onclick="navigateTo('/contact'); return false;">Contact Us</a></li>
                    </ul>
                </section>
            </div>

            <!-- Products Page -->
            <div id="products-page" class="page">
                <h1>Products Catalog</h1>
                <div class="form-group">
                    <input type="text" id="product-search" placeholder="Search products..." aria-label="Search products">
                </div>
                
                <div class="product-grid" id="product-grid">
                    <div class="product" data-product-id="p1">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='150'%3E%3Crect fill='%23ddd' width='200' height='150'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999'%3EProduct 1%3C/text%3E%3C/svg%3E" alt="Product 1">
                        <h3>Product Alpha</h3>
                        <p>$99.99</p>
                        <button class="btn" aria-label="Add Product Alpha to cart">Add to Cart</button>
                    </div>
                    <div class="product" data-product-id="p2">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='150'%3E%3Crect fill='%23ddd' width='200' height='150'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999'%3EProduct 2%3C/text%3E%3C/svg%3E" alt="Product 2">
                        <h3>Product Beta</h3>
                        <p>$149.99</p>
                        <button class="btn" aria-label="Add Product Beta to cart">Add to Cart</button>
                    </div>
                    <div class="product" data-product-id="p3">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='150'%3E%3Crect fill='%23ddd' width='200' height='150'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999'%3EProduct 3%3C/text%3E%3C/svg%3E" alt="Product 3">
                        <h3>Product Gamma</h3>
                        <p>$199.99</p>
                        <button class="btn" aria-label="Add Product Gamma to cart">Add to Cart</button>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="users-page" class="page">
                <h1>User Directory</h1>
                <button class="btn" id="load-more-users" aria-label="Load more users">Load More Users</button>
                
                <ul class="user-list" id="user-list">
                    <li class="user-item" data-user-id="u1">
                        <div class="user-avatar">JD</div>
                        <div>
                            <h3>John Doe</h3>
                            <p>john.doe@example.com</p>
                        </div>
                    </li>
                    <li class="user-item" data-user-id="u2">
                        <div class="user-avatar">JS</div>
                        <div>
                            <h3>Jane Smith</h3>
                            <p>jane.smith@example.com</p>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- Contact Page -->
            <div id="contact-page" class="page">
                <h1>Contact Us</h1>
                <form id="contact-form">
                    <div class="form-group">
                        <label for="contact-name">Name</label>
                        <input type="text" id="contact-name" required aria-label="Your name">
                    </div>
                    <div class="form-group">
                        <label for="contact-email">Email</label>
                        <input type="email" id="contact-email" required aria-label="Your email">
                    </div>
                    <div class="form-group">
                        <label for="contact-message">Message</label>
                        <textarea id="contact-message" rows="5" required aria-label="Your message"></textarea>
                    </div>
                    <button type="submit" class="btn" aria-label="Send message">Send Message</button>
                </form>
            </div>
        </div>
    </div>

    <div class="route-info">
        <div>Current Route: <span id="current-route">/</span></div>
        <div>Route Changes: <span id="route-count">0</span></div>
    </div>

    <script>
        // SPA Router Implementation
        let routeChangeCount = 0;
        const routes = {
            '/': 'home-page',
            '/products': 'products-page',
            '/users': 'users-page',
            '/contact': 'contact-page'
        };

        function navigateTo(path) {
            // Update browser history
            history.pushState({ path: path }, '', path);
            
            // Update UI
            updatePage(path);
            
            // Track route change
            routeChangeCount++;
            document.getElementById('route-count').textContent = routeChangeCount;
            document.getElementById('current-route').textContent = path;
            
            console.log('Route changed to:', path, '- pushState triggered');
            
            // Simulate async content loading
            setTimeout(() => {
                loadDynamicContent(path);
            }, 100);
        }

        function updatePage(path) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show current page
            const pageId = routes[path] || 'home-page';
            const page = document.getElementById(pageId);
            if (page) {
                page.classList.add('active');
            }
            
            // Update nav
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.route === path) {
                    link.classList.add('active');
                }
            });
        }

        function loadDynamicContent(path) {
            // Simulate dynamic content loading that would trigger DOM changes
            if (path === '/') {
                document.getElementById('timestamp').textContent = new Date().toLocaleTimeString();
            } else if (path === '/products') {
                // Could dynamically add more products
                console.log('Products page loaded, DOM updated');
            } else if (path === '/users') {
                // Could load more users
                console.log('Users page loaded, DOM updated');
            }
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', (event) => {
            const path = event.state?.path || '/';
            updatePage(path);
            document.getElementById('current-route').textContent = path;
            console.log('Popstate event - navigated to:', path);
        });

        // Setup nav links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const path = link.dataset.route;
                navigateTo(path);
            });
        });

        // Handle direct navigation (for testing)
        document.addEventListener('DOMContentLoaded', () => {
            const path = window.location.pathname;
            if (routes[path]) {
                updatePage(path);
                document.getElementById('current-route').textContent = path;
            }
            
            // Update timestamp
            document.getElementById('timestamp').textContent = new Date().toLocaleTimeString();
        });

        // Add dynamic user loading
        document.addEventListener('click', (e) => {
            if (e.target.id === 'load-more-users') {
                const userList = document.getElementById('user-list');
                const newUser = document.createElement('li');
                newUser.className = 'user-item';
                newUser.innerHTML = `
                    <div class="user-avatar">NU</div>
                    <div>
                        <h3>New User ${Date.now()}</h3>
                        <p>newuser@example.com</p>
                    </div>
                `;
                userList.appendChild(newUser);
                console.log('New user added - DOM updated');
            }
        });

        // Contact form handler
        document.getElementById('contact-form')?.addEventListener('submit', (e) => {
            e.preventDefault();
            alert('Form submitted! (This would trigger DOM update in real app)');
        });

        console.log('SPA initialized with history API tracking');
    </script>
</body>
</html>