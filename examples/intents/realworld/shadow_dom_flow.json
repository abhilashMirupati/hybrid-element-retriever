{
  "name": "Shadow DOM and iFrame Complex Interaction",
  "description": "Interact with elements inside Shadow DOM and iFrames",
  "url": "file:///workspace/examples/dom_samples/realworld/shadow_dom_iframe.html",
  "steps": [
    {
      "step": 1,
      "action": "type",
      "intent": "Enter full name in the regular form field",
      "value": "Jane Doe",
      "expected_locator": "//input[@id='full-name']",
      "validation": {
        "value_set": true,
        "expected_value": "Jane Doe"
      }
    },
    {
      "step": 2,
      "action": "type",
      "intent": "Type email address in the shadow DOM input",
      "value": "jane.doe@example.com",
      "expected_locator": "shadow://custom-input[@name='email']//input",
      "fallback_strategy": "pierce_shadow",
      "validation": {
        "value_set": true,
        "in_shadow_dom": true,
        "expected_value": "jane.doe@example.com"
      }
    },
    {
      "step": 3,
      "action": "type",
      "intent": "Enter phone number in shadow DOM field",
      "value": "+1 (555) 987-6543",
      "expected_locator": "shadow://custom-input[@name='phone']//input",
      "validation": {
        "value_set": true,
        "in_shadow_dom": true,
        "pattern_valid": true
      }
    },
    {
      "step": 4,
      "action": "select",
      "intent": "Select Canada from the country dropdown in shadow DOM",
      "value": "Canada",
      "expected_locator": "shadow://custom-dropdown[@name='country']//select",
      "validation": {
        "option_selected": true,
        "in_shadow_dom": true,
        "selected_value": "Canada"
      }
    },
    {
      "step": 5,
      "action": "type",
      "intent": "Enter card number in the payment iframe",
      "value": "4111111111111111",
      "expected_locator": "iframe:#payment-frame//input[@id='card-number']",
      "frame_context": "payment-frame",
      "validation": {
        "value_set": true,
        "in_iframe": true,
        "formatted_value": "4111 1111 1111 1111",
        "otp_triggered": true
      }
    },
    {
      "step": 6,
      "action": "type",
      "intent": "Enter card expiry date in iframe",
      "value": "1225",
      "expected_locator": "iframe:#payment-frame//input[@id='expiry']",
      "frame_context": "payment-frame",
      "validation": {
        "value_set": true,
        "in_iframe": true,
        "formatted_value": "12/25"
      }
    },
    {
      "step": 7,
      "action": "type",
      "intent": "Enter CVV security code",
      "value": "123",
      "expected_locator": "iframe:#payment-frame//input[@id='cvv']",
      "frame_context": "payment-frame",
      "validation": {
        "value_set": true,
        "in_iframe": true,
        "field_type": "password-like"
      }
    },
    {
      "step": 8,
      "action": "type",
      "intent": "Enter cardholder name",
      "value": "JANE DOE",
      "expected_locator": "iframe:#payment-frame//input[@id='cardholder']",
      "frame_context": "payment-frame",
      "validation": {
        "value_set": true,
        "in_iframe": true
      }
    },
    {
      "step": 9,
      "action": "type",
      "intent": "Enter OTP verification code",
      "value": "123456",
      "expected_locator": "iframe:#payment-frame//input[@id='otp-input']",
      "frame_context": "payment-frame",
      "validation": {
        "value_set": true,
        "in_iframe": true,
        "element_visible_after_trigger": true
      }
    },
    {
      "step": 10,
      "action": "toggle",
      "intent": "Enable express shipping option in nested shadow DOM",
      "expected_locator": "shadow://nested-component//shadow://inner-toggle[@name='express']//input",
      "nested_shadow": true,
      "validation": {
        "checked": true,
        "in_nested_shadow": true
      }
    },
    {
      "step": 11,
      "action": "toggle",
      "intent": "Enable insurance option",
      "expected_locator": "shadow://nested-component//shadow://inner-toggle[@name='insurance']//input",
      "nested_shadow": true,
      "validation": {
        "checked": true,
        "in_nested_shadow": true
      }
    },
    {
      "step": 12,
      "action": "click",
      "intent": "Submit the complete application form",
      "expected_locator": "//button[text()='Submit Application']",
      "validation": {
        "result_displayed": true,
        "all_data_collected": true,
        "cross_boundary_data": true
      }
    }
  ],
  "edge_cases": [
    "Shadow DOM requires special piercing strategy",
    "Nested shadow DOMs need recursive traversal",
    "iFrame context switching required",
    "OTP field appears conditionally after card entry",
    "Cross-boundary data collection via postMessage",
    "Custom elements with encapsulated styles and logic",
    "Form validation across different DOM boundaries"
  ],
  "technical_challenges": [
    "CDP DOM.getFlattenedDocument with pierce=true for shadow DOM",
    "Frame isolation and context switching",
    "Accessibility tree may not fully represent shadow DOM internals",
    "Custom element value getters/setters",
    "Conditional element visibility based on user input"
  ]
}